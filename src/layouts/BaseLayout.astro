---
import SEOHead from '@/components/SEOHead.astro';
import Header from '@/components/Header.astro';
import Footer from '@/components/Footer.astro';
import '@/styles/global.css';

interface Props {
  title: string;
  description: string;
  ogImage?: string;
  canonicalUrl?: string;
  noindex?: boolean;
}

const { title, description, ogImage, canonicalUrl, noindex } = Astro.props;
---

<!DOCTYPE html>
<html lang="he" dir="rtl">
  <head>
    <SEOHead
      title={title}
      description={description}
      ogImage={ogImage}
      canonicalUrl={canonicalUrl}
      noindex={noindex}
    />
    <!-- Google Analytics 4 -->
    <script is:inline async src="https://www.googletagmanager.com/gtag/js?id=G-1MWWGSNREK"></script>
    <script is:inline>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-1MWWGSNREK');
    </script>
    <slot name="head" />
  </head>
  <body class="min-h-screen flex flex-col bg-white text-dark font-heebo antialiased">
    <Header />
    <main class="flex-1">
      <slot />
    </main>
    <Footer />

    <!-- Sticky mobile phone button -->
    <a
      href="tel:077-231-2585"
      class="fixed bottom-4 left-4 z-50 md:hidden flex items-center gap-2 px-5 py-3 bg-ezgo-500 text-white font-semibold rounded-full shadow-lg hover:bg-ezgo-600 transition-colors"
      aria-label="חייגו עכשיו"
    >
      <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
      </svg>
      <span>חייגו עכשיו</span>
    </a>

    <!-- Accessibility widget button -->
    <button
      id="a11y-btn"
      class="fixed bottom-4 right-4 z-50 w-12 h-12 bg-dark text-white rounded-full shadow-lg hover:bg-gray-700 transition-colors flex items-center justify-center"
      aria-label="תפריט נגישות"
      title="נגישות"
    >
      <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="4" r="2" fill="currentColor" stroke="none" />
        <path stroke-linecap="round" stroke-linejoin="round" d="M4 8h16M12 8v4m-4 4l4-4 4 4" />
      </svg>
    </button>

    <!-- Accessibility panel -->
    <div id="a11y-panel" class="fixed bottom-20 right-4 z-50 bg-white rounded-xl shadow-2xl border border-border p-5 w-72 hidden">
      <div class="flex justify-between items-center mb-4">
        <h3 class="font-bold text-dark">נגישות</h3>
        <button id="a11y-close" class="text-gray-400 hover:text-dark" aria-label="סגור">
          <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
      <div class="space-y-3">
        <button id="a11y-font-increase" class="w-full text-right px-3 py-2 rounded-md bg-surface hover:bg-ezgo-50 text-sm transition-colors">הגדלת טקסט</button>
        <button id="a11y-font-decrease" class="w-full text-right px-3 py-2 rounded-md bg-surface hover:bg-ezgo-50 text-sm transition-colors">הקטנת טקסט</button>
        <button id="a11y-grayscale" class="w-full text-right px-3 py-2 rounded-md bg-surface hover:bg-ezgo-50 text-sm transition-colors">גווני אפור</button>
        <button id="a11y-contrast" class="w-full text-right px-3 py-2 rounded-md bg-surface hover:bg-ezgo-50 text-sm transition-colors">ניגודיות גבוהה</button>
        <button id="a11y-links" class="w-full text-right px-3 py-2 rounded-md bg-surface hover:bg-ezgo-50 text-sm transition-colors">הדגשת קישורים</button>
        <button id="a11y-reset" class="w-full text-right px-3 py-2 rounded-md bg-red-50 hover:bg-red-100 text-red-600 text-sm transition-colors">איפוס</button>
      </div>
      <a href="/accessibility/" class="block text-center text-xs text-ezgo-600 hover:text-ezgo-700 mt-3">הצהרת נגישות</a>
    </div>

    <script>
      const a11yBtn = document.getElementById('a11y-btn');
      const a11yPanel = document.getElementById('a11y-panel');
      const a11yClose = document.getElementById('a11y-close');
      const root = document.documentElement;

      a11yBtn?.addEventListener('click', () => a11yPanel?.classList.toggle('hidden'));
      a11yClose?.addEventListener('click', () => a11yPanel?.classList.add('hidden'));

      let fontSize = 100;
      document.getElementById('a11y-font-increase')?.addEventListener('click', () => {
        fontSize = Math.min(fontSize + 10, 150);
        root.style.fontSize = fontSize + '%';
      });
      document.getElementById('a11y-font-decrease')?.addEventListener('click', () => {
        fontSize = Math.max(fontSize - 10, 80);
        root.style.fontSize = fontSize + '%';
      });
      document.getElementById('a11y-grayscale')?.addEventListener('click', () => {
        root.classList.toggle('a11y-grayscale');
      });
      document.getElementById('a11y-contrast')?.addEventListener('click', () => {
        root.classList.toggle('a11y-contrast');
      });
      document.getElementById('a11y-links')?.addEventListener('click', () => {
        root.classList.toggle('a11y-links');
      });
      document.getElementById('a11y-reset')?.addEventListener('click', () => {
        fontSize = 100;
        root.style.fontSize = '';
        root.classList.remove('a11y-grayscale', 'a11y-contrast', 'a11y-links');
      });
    </script>

    <style is:global>
      .a11y-grayscale { filter: grayscale(1); }
      .a11y-contrast { filter: contrast(1.4); }
      .a11y-links a { outline: 3px solid #2563EB !important; outline-offset: 2px; }
    </style>
  </body>
</html>
