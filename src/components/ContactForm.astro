---
interface Props {
  compact?: boolean;
  title?: string;
}

const {
  compact = false,
  title = 'לקבלת ייעוץ מקצועי',
} = Astro.props;
---

<div class:list={['bg-white rounded-xl shadow-lg', compact ? 'p-4' : 'p-6 md:p-8']}>
  {!compact && (
    <h2 class="text-2xl font-bold text-dark mb-2">{title}</h2>
  )}
  {compact && (
    <h3 class="text-lg font-bold text-dark mb-3">{title}</h3>
  )}
  <p class="text-gray-600 text-sm mb-4">מלאו את הפרטים ונחזור אליכם בהקדם</p>

  <form id="contact-form" class="space-y-4">
    <div>
      <label for="name" class="block text-sm font-medium text-gray-700 mb-1">שם מלא</label>
      <input
        type="text"
        id="name"
        name="name"
        required
        class="w-full px-3 py-2.5 border border-border rounded-md focus:ring-2 focus:ring-ezgo-500 focus:border-ezgo-500 outline-none transition-colors"
        placeholder="השם שלכם"
      />
    </div>

    <div>
      <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">טלפון</label>
      <input
        type="tel"
        id="phone"
        name="phone"
        required
        pattern="[0-9\-\+]{9,15}"
        class="w-full px-3 py-2.5 border border-border rounded-md focus:ring-2 focus:ring-ezgo-500 focus:border-ezgo-500 outline-none transition-colors"
        placeholder="050-0000000"
        dir="ltr"
      />
    </div>

    <div>
      <label for="location" class="block text-sm font-medium text-gray-700 mb-1">אזור בארץ</label>
      <select
        id="location"
        name="location"
        required
        class="w-full px-3 py-2.5 border border-border rounded-md focus:ring-2 focus:ring-ezgo-500 focus:border-ezgo-500 outline-none transition-colors bg-white"
      >
        <option value="" disabled selected>בחרו אזור</option>
        <option value="צפון">צפון</option>
        <option value="מרכז">מרכז</option>
        <option value="דרום">דרום</option>
      </select>
    </div>

    <button
      type="submit"
      class="w-full py-3 bg-ezgo-500 text-white font-semibold rounded-md hover:bg-ezgo-600 transition-colors shadow-md hover:shadow-lg"
    >
      שלחו פנייה
    </button>

    <!-- Success/Error messages -->
    <div id="form-success" class="hidden text-center py-3 bg-green-50 text-green-700 rounded-md text-sm font-medium">
      הפנייה נשלחה בהצלחה! ניצור אתכם קשר בהקדם.
    </div>
    <div id="form-error" class="hidden text-center py-3 bg-red-50 text-red-700 rounded-md text-sm font-medium">
      אירעה שגיאה. אנא נסו שנית או התקשרו אלינו.
    </div>
  </form>
</div>

<script>
  const form = document.getElementById('contact-form') as HTMLFormElement;
  const successMsg = document.getElementById('form-success');
  const errorMsg = document.getElementById('form-error');

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData(form);
    const h1 = document.querySelector('h1')?.textContent?.trim() || document.title;
    const data = {
      'your-name': formData.get('name'),
      'phone': formData.get('phone'),
      'location': formData.get('location'),
      'page-title': h1,
      'form-type': 'almog_golfcart',
      'website': 'EZ-GO',
      'category': 'רכב תפעולי',
    };

    try {
      const res = await fetch('https://hook.eu1.make.com/aow7z2gnae1w1ms3kk56uvgnc3haknan', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data),
      });
      if (res.ok) {
        window.location.href = '/thank-you/';
        return;
      } else {
        errorMsg?.classList.remove('hidden');
      }
    } catch {
      errorMsg?.classList.remove('hidden');
    }
  });
</script>
